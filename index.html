<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hokkaido Ski Trip 2025-26</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
    </style>
</head>
<body class="bg-slate-900">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- 圖示元件 (Icon Components) ---
        const IconWrapper = ({ children, size = 16, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Plane = (props) => <IconWrapper {...props}><path d="M2 12h20"/><path d="M13 2l9 10-9 10"/><path d="M2 12l5-5m0 10l-5-5"/></IconWrapper>;
        const Hotel = (props) => <IconWrapper {...props}><path d="M18 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"/><polyline points="10 2 10 22"/><polyline points="6 2 6 22"/><polyline points="14 2 14 22"/><polyline points="18 2 18 22"/></IconWrapper>;
        const Snowflake = (props) => <IconWrapper {...props}><line x1="2" y1="12" x2="22" y2="12"></line><line x1="12" y1="2" x2="12" y2="22"></line><path d="M20 16l-4-4 4-4"></path><path d="M4 8l4 4-4 4"></path><path d="M16 4l-4 4-4-4"></path><path d="M8 20l4-4 4 4"></path></IconWrapper>;
        const Bus = (props) => <IconWrapper {...props}><rect x="3" y="6" width="18" height="12" rx="2"/><circle cx="7" cy="18" r="2"/><circle cx="17" cy="18" r="2"/><path d="M3 11h18"/></IconWrapper>;
        const MapPin = (props) => <IconWrapper {...props}><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></IconWrapper>;
        const Calendar = (props) => <IconWrapper {...props}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></IconWrapper>;
        const CloudSnow = (props) => <IconWrapper {...props}><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M8 15h.01"/><path d="M8 19h.01"/><path d="M12 17h.01"/><path d="M12 21h.01"/><path d="M16 15h.01"/><path d="M16 19h.01"/></IconWrapper>;

        // --- 資料設定 (Data Configuration) ---
        const RESORTS = [
            { id: "teine", name: "札幌手稻 (Teine)", lat: 43.098, lon: 141.206 },
            { id: "hirafu", name: "二世谷 Hirafu", lat: 42.863, lon: 140.703 },
            { id: "tengu", name: "小樽天狗山", lat: 43.183, lon: 140.985 },
            { id: "onze", name: "Snow Cruise Onze", lat: 43.145, lon: 141.132 },
            { id: "asari", name: "朝里川溫泉", lat: 43.158, lon: 141.053 },
        ];

        // 為了避免 SyntaxError，將屬性分行撰寫
        const ITINERARY = [
            {
                date: "12/31",
                weekday: "週三",
                title: "啟程 & 小樽漫遊",
                highlight: "虎航 IT234",
                events: [
                    { 
                        time: "06:20", 
                        icon: <Plane size={16} />, 
                        text: "TPE 桃園 T1 起飛", 
                        sub: "IT234 (06:20 - 10:55)" 
                    },
                    { 
                        time: "10:55", 
                        icon: <MapPin size={16} />, 
                        text: "抵達新千歲 (CTS)", 
                        sub: "入境手續 & 領行李" 
                    },
                    { 
                        time: "13:00", 
                        icon: <Bus size={16} />, 
                        text: "JR/巴士前往小樽", 
                        sub: "欣賞沿途海景" 
                    },
                    { 
                        time: "15:00", 
                        icon: <Hotel size={16} />, 
                        text: "入住：OMO5 小樽", 
                        sub: "星野集團都市觀光飯店" 
                    }
                ]
            },
            {
                date: "01/01",
                weekday: "週四",
                title: "元旦首滑：手稻",
                highlight: "Teine Highland",
                events: [
                    { 
                        time: "09:00", 
                        icon: <Snowflake size={16} />, 
                        text: "札幌手稻滑雪場", 
                        sub: "奧運賽道體驗" 
                    },
                    { 
                        time: "17:00", 
                        icon: <Hotel size={16} />, 
                        text: "返回 OMO5 小樽", 
                        sub: "小樽運河晚餐" 
                    }
                ]
            },
            {
                date: "01/02",
                weekday: "週五",
                title: "遠征二世谷",
                highlight: "Big Run Bus",
                events: [
                    { 
                        time: "08:30", 
                        icon: <Bus size={16} />, 
                        text: "搭乘 Big Run Bus", 
                        sub: "直達二世谷 Hirafu" 
                    },
                    { 
                        time: "11:00", 
                        icon: <Snowflake size={16} />, 
                        text: "Hirafu 滑雪體驗", 
                        sub: "朝聖世界級粉雪" 
                    },
                    { 
                        time: "16:00", 
                        icon: <Bus size={16} />, 
                        text: "返回小樽", 
                        sub: "" 
                    }
                ]
            },
            {
                date: "01/03",
                weekday: "週六",
                title: "海景雙雪場特攻",
                highlight: "天狗山 + Onze",
                events: [
                    { 
                        time: "09:00", 
                        icon: <Snowflake size={16} />, 
                        text: "天狗山滑雪場", 
                        sub: "眺望小樽港絕景" 
                    },
                    { 
                        time: "13:00", 
                        icon: <Bus size={16} />, 
                        text: "移動至 Onze", 
                        sub: "車程約 30-40 分鐘" 
                    },
                    { 
                        time: "14:00", 
                        icon: <Snowflake size={16} />, 
                        text: "Snow Cruise Onze", 
                        sub: "一路滑到夜滑時段 (23:00)" 
                    }
                ]
            },
            {
                date: "01/04",
                weekday: "週日",
                title: "朝里川溫泉滑雪",
                highlight: "Asari Ski",
                events: [
                    { 
                        time: "09:00", 
                        icon: <Snowflake size={16} />, 
                        text: "朝里川溫泉滑雪場", 
                        sub: "寬廣雪道適合練功" 
                    },
                    { 
                        time: "18:00", 
                        icon: <Hotel size={16} />, 
                        text: "最後一晚小樽/札幌", 
                        sub: "整理裝備" 
                    }
                ]
            },
            {
                date: "01/05",
                weekday: "週一",
                title: "完美賦歸",
                highlight: "虎航 IT235",
                events: [
                    { 
                        time: "08:00", 
                        icon: <Bus size={16} />, 
                        text: "前往新千歲機場", 
                        sub: "預留逛國內線航廈時間" 
                    },
                    { 
                        time: "11:55", 
                        icon: <Plane size={16} />, 
                        text: "CTS 新千歲起飛", 
                        sub: "IT235 (11:55 - 15:35)" 
                    },
                    { 
                        time: "15:35", 
                        icon: <MapPin size={16} />, 
                        text: "抵達桃園 T1", 
                        sub: "平安回家" 
                    }
                ]
            }
        ];

        // --- 主應用程式 (Main Application) ---
        function SkiTripApp() {
            const [activeTab, setActiveTab] = useState("schedule"); 
            const [weatherData, setWeatherData] = useState({});
            const [loading, setLoading] = useState(false);

            useEffect(() => {
                const fetchWeather = async () => {
                    setLoading(true);
                    const data = {};
                    try {
                        await Promise.all(RESORTS.map(async (resort) => {
                            // 使用 URLSearchParams 構建查詢參數，避免長字串錯誤
                            const params = new URLSearchParams({
                                latitude: resort.lat,
                                longitude: resort.lon,
                                daily: "temperature_2m_max,temperature_2m_min,snowfall_sum",
                                timezone: "Asia/Tokyo",
                                forecast_days: 5
                            });
                            
                            const response = await fetch(`https://api.open-meteo.com/v1/forecast?${params.toString()}`);
                            const json = await response.json();
                            data[resort.id] = json;
                        }));
                        setWeatherData(data);
                    } catch (error) {
                        console.error("天氣獲取失敗", error);
                    } finally {
                        setLoading(false);
                    }
                };

                if (activeTab === "weather") {
                    fetchWeather();
                }
            }, [activeTab]);

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-800 text-slate-100 font-sans flex justify-center">
                    <div className="w-full max-w-md bg-white/10 backdrop-blur-md min-h-screen shadow-2xl border-x border-white/10 flex flex-col">
                        
                        {/* Header Area */}
                        <header className="pt-8 pb-6 px-6 bg-gradient-to-b from-black/40 to-transparent">
                            <div className="flex justify-between items-start mb-4">
                                <div>
                                    <h1 className="text-3xl font-bold text-white tracking-tight drop-shadow-lg">Hokkaido Ski</h1>
                                    <p className="text-blue-200 text-sm font-medium mt-1 flex items-center gap-1">
                                        <Calendar size={14} /> 2025/12/31 - 2026/01/05
                                    </p>
                                </div>
                                <div className="bg-blue-500/20 p-2 rounded-full border border-blue-400/30">
                                    <Snowflake className="text-blue-300 w-6 h-6 animate-pulse" />
                                </div>
                            </div>
                            
                            {/* Flight Card */}
                            <div className="bg-white/10 rounded-xl p-3 border border-white/10 flex justify-between items-center text-xs text-gray-300">
                                <div className="flex flex-col items-center">
                                    <span className="font-bold text-white text-lg">TPE</span>
                                    <span>06:20</span>
                                </div>
                                <div className="flex flex-col items-center px-2">
                                    <Plane size={14} className="text-blue-400 mb-1" />
                                    <div className="h-[1px] w-12 bg-blue-400/50"></div>
                                    <span className="text-[10px] mt-1 text-blue-300">IT234/235</span>
                                </div>
                                <div className="flex flex-col items-center">
                                    <span className="font-bold text-white text-lg">CTS</span>
                                    <span>10:55</span>
                                </div>
                            </div>
                        </header>

                        {/* Navigation Tabs */}
                        <div className="px-4 mb-4">
                            <div className="bg-black/20 p-1 rounded-2xl flex backdrop-blur-sm border border-white/5">
                                <button
                                    onClick={() => setActiveTab("schedule")}
                                    className={`flex-1 py-2.5 rounded-xl text-sm font-bold transition-all duration-300 ${
                                        activeTab === "schedule" 
                                        ? "bg-blue-500 text-white shadow-lg shadow-blue-500/30" 
                                        : "text-gray-400 hover:text-white"
                                    }`}
                                >
                                    行程總覽
                                </button>
                                <button
                                    onClick={() => setActiveTab("weather")}
                                    className={`flex-1 py-2.5 rounded-xl text-sm font-bold transition-all duration-300 ${
                                        activeTab === "weather" 
                                        ? "bg-blue-500 text-white shadow-lg shadow-blue-500/30" 
                                        : "text-gray-400 hover:text-white"
                                    }`}
                                >
                                    雪場情報
                                </button>
                            </div>
                        </div>

                        {/* Main Content Area */}
                        <div className="flex-1 overflow-y-auto px-4 pb-20 scrollbar-hide">
                            {activeTab === "schedule" ? (
                                <div className="space-y-5 animate-in fade-in slide-in-from-bottom-4 duration-500">
                                    {ITINERARY.map((day, index) => (
                                        <div key={index} className="relative pl-4">
                                            {/* Time Line */}
                                            <div className="absolute left-0 top-4 bottom-0 w-[2px] bg-gradient-to-b from-blue-500 to-transparent opacity-30"></div>
                                            
                                            <div className="bg-slate-800/80 border border-slate-700/50 p-4 rounded-2xl shadow-xl hover:border-blue-500/30 transition-colors">
                                                <div className="flex justify-between items-center mb-3">
                                                    <div className="flex items-center gap-2">
                                                        <span className="bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded-md shadow-md">
                                                            {day.date}
                                                        </span>
                                                        <span className="text-slate-400 text-xs font-medium">{day.weekday}</span>
                                                    </div>
                                                    <span className="text-xs font-bold text-blue-300 bg-blue-500/10 px-2 py-1 rounded-full border border-blue-500/20">
                                                        {day.highlight}
                                                    </span>
                                                </div>
                                                
                                                <h3 className="font-bold text-lg text-white mb-4 flex items-center gap-2">
                                                    {day.title}
                                                </h3>

                                                <div className="space-y-4">
                                                    {day.events.map((event, idx) => (
                                                        <div key={idx} className="flex items-start gap-3 group">
                                                            <div className="mt-1 p-1.5 rounded-full bg-slate-700/50 text-blue-400 group-hover:bg-blue-500 group-hover:text-white transition-colors duration-300">
                                                                {event.icon}
                                                            </div>
                                                            <div className="flex-1">
                                                                <div className="flex justify-between items-baseline">
                                                                    <span className="text-slate-200 font-medium text-sm">{event.text}</span>
                                                                    <span className="text-slate-500 text-xs font-mono">{event.time}</span>
                                                                </div>
                                                                {event.sub && (
                                                                    <p className="text-slate-500 text-xs mt-0.5">{event.sub}</p>
                                                                )}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            ) : (
                                <div className="space-y-4 animate-in fade-in slide-in-from-bottom-4 duration-500">
                                    <div className="bg-blue-900/40 p-3 rounded-xl border border-blue-500/30 flex gap-3 items-center">
                                        <div className="bg-blue-500 p-2 rounded-lg">
                                            <CloudSnow className="text-white w-5 h-5" />
                                        </div>
                                        <div className="text-xs text-blue-100">
                                            <p className="font-bold">即時雪況預測</p>
                                            <p className="opacity-70">資料來源: Open-Meteo (未來5日)</p>
                                        </div>
                                    </div>

                                    {loading && (
                                        <div className="text-center py-20">
                                            <Snowflake className="w-10 h-10 text-blue-500 animate-spin mx-auto mb-3"/>
                                            <p className="text-slate-400 text-sm">正在連線至氣象衛星...</p>
                                        </div>
                                    )}

                                    {!loading && RESORTS.map((resort) => {
                                        const forecast = weatherData[resort.id]?.daily;
                                        return (
                                            <div key={resort.id} className="bg-slate-800/90 p-5 rounded-2xl border border-slate-700 shadow-lg">
                                                <div className="flex justify-between items-center mb-4">
                                                    <h3 className="font-bold text-white text-lg">{resort.name}</h3>
                                                    <a 
                                                        href={`https://www.google.com/maps?q=${resort.lat},${resort.lon}`} 
                                                        target="_blank" 
                                                        rel="noreferrer" 
                                                        className="text-blue-400 hover:text-blue-300"
                                                    >
                                                        <MapPin size={18} />
                                                    </a>
                                                </div>
                                                
                                                {forecast ? (
                                                    <div className="grid grid-cols-5 gap-2">
                                                        {forecast.time.map((dateStr, i) => {
                                                            const date = new Date(dateStr);
                                                            const dayMonth = `${date.getMonth() + 1}/${date.getDate()}`;
                                                            const snow = forecast.snowfall_sum[i];
                                                            const maxT = forecast.temperature_2m_max[i];
                                                            const snowColor = snow > 10 ? "text-white font-bold" : (snow > 0 ? "text-blue-200" : "text-slate-500");

                                                            return (
                                                                <div key={i} className="flex flex-col items-center">
                                                                    <span className="text-[10px] text-slate-400 mb-1">{dayMonth}</span>
                                                                    
                                                                    <div className="w-full bg-slate-700/50 rounded-t-md flex items-end justify-center h-12 relative overflow-hidden">
                                                                        <div 
                                                                            className="w-full bg-blue-500/80 absolute bottom-0 transition-all duration-1000" 
                                                                            style={{ height: `${Math.min((snow/20)*100, 100)}%` }}
                                                                        ></div>
                                                                        <span className={`relative z-10 text-[10px] mb-1 ${snowColor}`}>
                                                                            {snow > 0 ? snow : "-"}
                                                                        </span>
                                                                    </div>
                                                                    
                                                                    <div className="mt-1 text-[10px] text-slate-300">
                                                                        {Math.round(maxT)}°
                                                                    </div>
                                                                </div>
                                                            )
                                                        })}
                                                    </div>
                                                ) : (
                                                    <p className="text-sm text-red-400">暫無數據</p>
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SkiTripApp />);
    </script>
</body>
</html>